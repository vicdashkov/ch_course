Preparation:
* rm data dir
* rm preprocessed configs
* slides
* browser tabix
* vs with course notes

Welcome back everyone.

Sometimes we all have a lot of data to process. khm
Which is all well and good. But not always do we have ram to process it.

Ch has an answer here
If we enable sampling on our table, we can save on RAM quite a bit,
since CH will perform your query on a small subset of our data.

ok. lets start by creating regular table

-- swithc to tabix

-- fastworward til execute all commands

ok so what we saw is of course regular select works,
But sampling not so much.
To fix it, we need to of course to enable sampling

let's fix it with proper sampling table

-- switch to tabix tab 2

Now when we select from this table ch will return an evenly pseudorandom data sample.

ok sort of makes sense. let's benchmark a bit

-- switch to tab 3

lets create 2 separate benchmarking tables

and lets run our inserter and selecter,
We've seen them in action, so we know what to expecte, I'll just note that
I've changed configs accordingly with new dbs and table names

refer to lesson files for the bash script

and

Please note that I enabled query log for my user,
It will help us to compare memory usage for our queries

with command like this

-- switch to tabix tab 4

Refer to users.xml for an axample of config that enables query log

-- open files on investigation

So I put 365000000 events to our tables beforehand, and results are as follows

Dramatic pouse

And I couldn't make sampling to work properly.
There's the file called called sampling_investigation.

You can give it a read, I'll just summarize by saying that
I couldn't quite see any performance benefits from using sampling

Even memory consuption didn't go down
Good news is that if you dont use "sample" in your select query
table with sampling enabled will work just as fine and won't take
much more space as well.
But I would strongly suggest to benchmark your schema. maybe you'll find a good
combination of primary key, select clouse and so on to make it work.
Plus maybe it will work for your more complex select statements

Please let me know if you made it to work.

See you next time