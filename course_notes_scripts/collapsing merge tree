Hi everyone.
Today we'll talk about collapsing merge tree
This is an interesting engine. At my place we used it because at some point CH didn't support updates
And for one of our tables it sort of made sense.
We still use it, but we would've done it without it now.

Still I think It's important to talk about it, since there are use cases for it that
you might encounter.

Let's start by creating a table

-- tabix

I strongly suggest using default value for sign, if you insert
any other value instead of -1 or 1, you will see pretty ugly error in logs
and CH won't be able to ever collapse the table

Let's now try to inset. Clickhouse docs sugget this way.
You need to cancel and remember previous state. Ok lets see what happens

-- tabix

lets test our table
and there are 2 ways

-- tabix

But now you can also insert values like this and as far as I can tell it will still work

-- tabix

and if you execute
-- tabix

ok so ch documentation has pretty good overview and explanation of this topic
There's also additional link attached with some more discussion on the topic

So why use it?
If you have some entity that changes all the time, but you don't have time to wait for data writes.
Merge tree will make sure data is changed, but perform expensive i/o operation only a few times
to save you on server cost.